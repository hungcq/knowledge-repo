# Elastic compute cloud (EC2)
- Create budget to get notified about cost passing a specific budget
- Config:
  - Window
  - CPU: cores & compute power
  - RAM
  - Storage:
    - Network attached (EBS & EFS)
    - Hardware (EC2 instance store)
  - Network card: speed, public IP
  - Firewall rules: security group
  - Bootstrap script: config instance at first run (EC2 user data). Not run when restart.
- Naming convention: m5.2xlarge:
  - m: instance class
  - 5: generation (higher better)
  - 2xlarge: size within the instance class
- Security group:
  - Control traffic into/out of EC2 instances (~firewall outside the instance)
  - Contain only allow rules
  - Can reference by IP/security group
  - Regulate:
    - Access to port
    - Authorized IP ranges
  - Group:Instance n:n
  - Locked down to a region/VPC combination
  - Recommendation: maintain one security group for SSH access
  - Default:
    - Block all inbound traffic
    - Allow all outbound traffic
  - Troubleshooting:
    - Timeout (not accessible): security group issue
    - Connection refused: app error (eg not launched)
- Attach role to instance to give it permissions (not aws configure)
- Purchase options:
  - On-demand: short workload, predictable pricing, pay by second
  - Reserved (1/3 years):
    - Long workload (eg DB)
    - Can be sell in marketplace
    - Convertible reserved: flexible instance
  - Saving plan (1/3 years): commitment to an amount of usage, long workload.
    Usage beyond saving plan billed at on-demand price.
  - Spot instance:
    - Short workload, resistant to failure, cheapest, can lose instance if someone paying more
    - -> Define max spot price & get the instance when current spot price < max
    - Create via spot request
    - Spot request is independent of spot instance
    - -> To terminate: cancel request then terminate instance
    - Spot fleet: set of spot instances + (optional) on-demand instances:
      - Try to meet capacity within price constraints
      - Define launch pools: instance type, OS, AZ
      - Strategies:
        - Lowest price pool
        - Diversified: distributed across pools
        - Capacity optimized: highest capacity pool
        - Price capacity optimized (recommended): highest capacity -> lowest price
  - Dedicated host:
    - Book entire physical server, control instance placement
    - To address compliance requirement/software licence per socket/core/VM
    - Purchase options:
      - On-demand
      - Reserved
    - Most expensive
  - Dedicated instance: no other customers share the hardware
  - Capacity reservation: reserve on-demand capacity in a specific AZ for any duration
  - -> Suitable for short-term uninterrupted workload on specific AZ
- Private IP: access the internet via NAT + internet gateway
- Elastic IP:
  - IPv4
  - Used to have fixed IP for EC2 instance
  - Can be attached to one instance at a time
  - -> If one instance fails, can move to another instance
  - Max: 5 per account
  - Best practice: avoid using Elastic IP, use random public IP & assign DNS name to instance or use LB
- Placement group: control over EC2 instances placement strat:
  - Cluster: into low latency cluster (same rack) within AZ -> higher risk of failure
  - -> Use case: HPC
  - Spread: spread over underlying hardware (max 7 instances per group per AZ)
  - -> Use case: critical apps
  - Partition: spread over partitions (on dif racks, max 7 per AZ). Partitions are separated from each other's failure.
  - -> Used for partition-aware app (eg Kafka, Hadoop)
- -> Select when launch EC2 instance
- Elastic network interface (ENI):
  - Logical component in VPC representing a virtual network card
  - Attributes:
    - 1 primary private v4 IP
    - 1+ secondary private v4 IP
    - 1 public IPv4
    - 1+ security group
    - 1 MAC address
  - Can be created independently & move (attach) to EC2 on the fly for failover
  - Bound to specific AZ
- -> Use to have more control over private IP
- Hibernate: preserve RAM state into disk
- -> Faster boot
- AMI (amazon machine image):
  - Customization of EC2 instance (eg software, config)
  - -> Faster boot & config time
  - Built for specific region, can be copied across regions
  - Can launch instances from:
    - Public AMI
    - Your own AMI: need to create & maintain
    - Marketplace AMI: created & sold by others
