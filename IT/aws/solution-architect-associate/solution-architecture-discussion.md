# Solution architecture discussion
- 5 pillars:
  - Cost
  - Performance
  - Reliability
  - Security
  - Operational excellence
- WhatIsTheTime: stateless web app:
  - 1 instance, scaling vertically
  - -> Elastic IP
  - Scaling horizontally
  - -> DNS, A record, multiple IPs
  - -> DNS, Alias record + ELB + health check for availability
  - Autoscaling group: reduce manual operation effort
  - -> Multi AZs for availability
  - Reserved instance for cost saving
- MyClothes: stateful web app: online shopping with cart:
  - ELB stateful session: maintain user session
  - -> Cookies: heavy request, need validation
  - -> Server session in ElastiCache/DynamoDB, session ID stored in cookies
  - RDS stores user data
  - -> Cache/read replicas to scale read
  - Multi Azs for ELB, ASG, RDS, ElastiCache for availability
  - Security group ref each other to restrict to private traffic (except LB) for security
- MyWordPress: global scale, support picture upload & access:
  - File storage: EBS volume attach to 1 EC2 instance
  - -> EFS for scalability, use ENI attached to EC2 instances to connect to EFS
  - Aurora RDS for easy multi AZs & read replicas
- Instantiate apps quickly:
  - EC2: use Golden AMI: install OS, app dependencies beforehand
  - -> Beanstalk to mix Golden AMI & dynamic user data script
  - RDS DB: restore from snapshot -> schema ready
  - EBS volume: restore from snapshot: disk formatted & have data
- Elastic Beanstalk:
  - Def: dev centric view of deploying an app on AWS
  - -> Managed service, dev do configuration & code
  - Use commonly used components: eg EC2, ASG, ELB, RDS
  - Cost:
    - Beanstalk: free
    - Other components: cost money
  - Components:
    - App: collections of Beanstalk components (envs, versions, configs)
    - App version: iteration of app code
    - Env:
      - Def: collection of AWS resources running an app version
      - Tiers: web env tier & worker env tier (process work using queue, scale based on queue load)
      - Can create multiple env
    - Process: create app -> upload app version -> launch env -> manage env
    - Deployment mode:
      - Single instance: suitable for dev
      - High availability with LB & RDS failover: suitable for production
- Snowball to Glacier: snowball -> S3 -> Glacier (via lifecycle policy)
- ECS:
  - ECS task invoked by EventBridge: client -> S3 bucket -> EventBridge event -> ECS task: get object from S3 -> DynamoDB
  - ECS task invoke by EventBridge schedule: EventBridge event every 1 hour -> ECS task: batch processing -> S3
  - ECS - SQS queue: autoscaling tasks poll for SQS messages
  - ECS intercept stopped tasks using EventBridge: exited ECS task -> EventBridge event -> SNS: email -> admin
## Serverless
- MyTodoList: serverless mobile app:
  - Requirements:
    - REST APIs with HTTP
    - User can interact with their dir in S3
    - Authentication
  - Architecture: client -> API Gateway -> Lambda -> DynamoDB. Authentication: client -> Cognito <-> API Gateway
  - -> Improve read throughput: DAX, cache at API Gateway
- MyBlog.com: serverless website:
  - Requirements:
    - Scale globally
    - Send welcome email to new users
    - HTTP APIs
    - Serve static files: 
    - Generate thumbnail
    - Caching
  - Flow:
    - Static content: client -> CloudFront -> S3 (secured with bucket policy)
    - API call: client -> API Gateway -> Lambda -> DAX -> DynamoDB Global Tables -> Stream -> Lambda -> Simple Email Service (SES)
    - Thumbnail generation: client -> CloudFront -> S3 -> Lambda -> S3
- Microservices: options:
  - ELB -> ECS
  - API Gateway -> Lambda
  - ELB -> EC2 ASG
- Software updates offloading:
  - Problem: app on EC2 distributing software updates occasionally -> costly networking
  - Solution: add CloudFront on top to distribute static update files
  - -> No code change needed
## Data storage use cases
- RDS: OLTP
- Aurora: ~RDS, better performance, more features
- ElastiCache (require code change): key value store, session data, DB cache
- DynamoDB: evolving schema, DB for serverless app, serverless cache
- S3: big objects: static file, KV store for big files, website hosting
- DocumentDB (managed MongoDB): ~Aurora for document DB
- Neptune (graph DB): knowledge graph, fraud detection, recommendation engine, social networking
- Keyspaces (managed Apache Cassandra)
- Quantum ledger database (QLDB):
  - Ledger DB: immutable, record all changes to data, cryptographically verifiable
  - Vs Managed Blockchain: centralized DB -> comply with financial laws
- Timestream (time series DB): sample architecture: Prometheus -> Timestream -> Grafana
## Big Data Ingestion Pipeline
- IoT devices -> Kinesis Data Streams -> Firehose <-> Lambda transformation -> S3 ingestion bucket
  -> Lambda -> Athena (process ingestion bucket) -> S3 reporting bucket -> Redshift/Quicksight
## CloudTrail - EventBridge integration
- API call interception: API call in AWS services -> CloudTrail: event -> EventBridge -> SNS
## DDoS protection
- Edge location layer: protected at CloudFront, GA, Route53
- Infra layer defense: protect EC2 against high traffic:
  - Edge location mitigation approaches
  - EC2 with ASG & ELB
- Application layer:
  - CloudFront for static content
  - WAF in front of ALB
  - Shield Advanced
- Attack surface reduction:
  - Obfuscating AWS resources (hide BE with API Gateway, ELB, CloudFront)
  - Security groups & network ACLs
  - Protect API endpoints: hide BE, CloudFront, WAF + API Gateway
## GuardDuty
- Def: intelligent thread discovery to protect AWS account
- Use ML, anomaly detection, third party data
- Input data:
  - CloudTrail Event Logs:
    - Management Events
    - S3 Data Events
  - VPC Flow Logs
  - DNS Logs
  - Optional Features: eg EKS Audit Logs, RDS & Aurora
- Can setup EventBridge rules for noti
- Can protect against CryptoCurrency attacks (has dedicated finding for it)
## Inspector
- Def: automated security assessment
- Target:
  - EC2 instances: use System Manager agent to analyze:
    - Unintended network accessibility
    - Known vulnerabilities of running OS
  - Container images pushed to ECR
  - Lambda
- Reporting & integration with Security Hub/EventBridge
## Macie
- Def: managed data security & privacy service using ML & pattern matching to discover & protect sensitive data in AWS
- -> Identify & alert to sensitive data (eg personally identifiable info)
- Noti via EventBridge
## VPC Flow Logs:
- Flow Logs -> CW Logs -> CW Contributor Insights -> Top IP addresses
- Flow Logs -> CW Logs -> Metric Filter -> CW Alarm -> SNS
- Flow Logs -> S3 -> Athena -> QuickSight (visualization)